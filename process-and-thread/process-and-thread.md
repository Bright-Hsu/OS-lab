# process and thread

## 1.1 实验目的

1. 在华为云上搭建openEuler操作系统环境

   本实验旨在熟悉基于Kunpeng架构弹性云服务器ECS上openEuler操作系统基本系统环境。通过运行shell命令查看系统信息以达到了解openEuler操作系统的目的。

2. 进程、线程相关编程实验

通过编写和运行简单的进程、线程相关程序，体会进程调度、进程间变量管理、进程调用其他程序、线程等方面在操作系统中的实际操作。

3. ubuntu虚拟机的安装与使用

熟悉 Linux 操作系统的安装步骤，建立实验环境。

## 1.2 实验内容

一、进程相关编程实验

a) 观察进程调度；

b) 观察进程调度中的全局变量改变；

c) 在子进程中调用system函数；

d) 在子进程中调用exec族函数。

在此实验中完成：

  （1）熟悉操作命令、编辑、编译、运行程序。完成操作系统原理课程教材P103作业 3.7 （采用图3-32所示的程序）的运行验证，多运行程序几次观察结果；去除wait后再观察结果并进行理论分析。

  （2）扩展图3-32的程序，添加一个全局变量并在父进程和子进程中对这个变量做不同操作，输出操作结果并解释；在return前增加对全局变量的操作并输出结果，观察并解释；修改程序体会在子进程中调用system函数和在子进程中调用exec族函数；

二、线程相关编程实验

创建两个线程运行后体会线程共享进程信息的知识。

 

## 1.3 实验与验收要求

1. 基本要求：多次运行程序，观察输出顺序，解释现象。

2. 扩展要求：

（1）定义全局变量，在父子进程分别操作，观察结果并解释现象；

（2）父子进程运行不同程序（可使用exec函数实现）；

（3）使用pthread实现多线程。

## 1.4 实验原理

**1. fork****函数**

fork系统调用用于创建一个新进程，称为子进程，它与进程（称为系统调用fork的进程）同时运行，此进程称为父进程。创建新的子进程后，两个进程将执行fork（）系统调用之后的下一条指令。子进程使用相同的pc（程序计数器），相同的CPU寄存器，在父进程中使用的相同打开文件。

它不需要参数并返回一个整数值。下面是fork（）返回的不同值。

(1) 在父进程中，fork返回新创建子进程的进程ID；

(2) 在子进程中，fork返回0；

(3) 如果出现错误，fork返回一个负值。

**2. exec****函数族和****system****函数**

在Linux/Unix系统中，system函数会调用fork函数产生子进程，由子进程来执行command命令，命令执行完后随即返回原调用的进程。

exec函数族提供了一个在进程中启动另一个程序执行的方法。它可以根据指定的文件名或目录名找到可执行文件，并用它来取代原调用进程的数据段、代码段和堆栈段，在执行完之后，原调用进程的内容除了进程号外，其他全部被新的进程替换了。

**3. pthread API实现多线程**

Pthreads 指定 API 来处理线程要求的大部分行为. 这些行为包括创建和终止线程、等待线程完成、以及管理线程之间的交互. 后面的目录中存在各种锁定机制，能够阻止两个线程同时尝试修改相同的数据值，这些锁定机制包括互斥锁、条件变量。

 

**4.** **信号量semaphore**

Semaphore是用来保护一个或者多个共享资源的访问，Semaphore内部维护了一个计数器，其值为可以访问的共享资源的个数。一个线程要访问共享资源，先获得信号量，如果信号量的计数器值大于1，意味着有共享资源可以访问，则使其计数器值减去1，再访问共享资源。如果计数器值为0,线程进入休眠。当某个线程使用完共享资源后，释放信号量，并将信号量内部的计数器加1，之前进入休眠的线程将被唤醒并再次试图获得信号量。

Semaphore使用时需要先构建一个参数来指定共享资源的数量，Semaphore构造完成后即是获取Semaphore、共享资源使用完毕后释放Semaphore。

